<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Support Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Login Form -->
        <div id="loginForm" class="container-fluid vh-100 d-flex align-items-center justify-content-center bg-light">
            <div class="card shadow-lg" style="width: 400px;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-headset fa-3x text-primary mb-3"></i>
                        <h2 class="card-title">Support Portal</h2>
                        <p class="text-muted">Sign in to access the support dashboard</p>
                    </div>
                    <form id="loginFormElement">
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-3">Sign In</button>
                        <div class="text-center">
                            <small class="text-muted">Demo Mode: Any email and password will work</small>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" class="d-none">
            <!-- Navigation -->
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <i class="fas fa-headset me-2"></i>Support Tool
                    </a>
                    <div class="navbar-nav ms-auto">
                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-1"></i>
                                <span id="userName">User</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="container-fluid">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-md-3 col-lg-2 sidebar bg-light p-0">
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action active" onclick="showSection('overview')">
                                <i class="fas fa-tachometer-alt me-2"></i>Overview
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('tickets')">
                                <i class="fas fa-ticket-alt me-2"></i>Tickets
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('customers')">
                                <i class="fas fa-users me-2"></i>Customers
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('knowledge')">
                                <i class="fas fa-book me-2"></i>Knowledge Base
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('automation')">
                                <i class="fas fa-cogs me-2"></i>Automation
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('ai')">
                                <i class="fas fa-robot me-2"></i>AI Assistant
                            </a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="showSection('issues')">
                                <i class="fas fa-exclamation-triangle me-2"></i>Issue Detection
                            </a>
                        </div>
                    </div>

                    <!-- Main Content Area -->
                    <div class="col-md-9 col-lg-10 main-content">
                        <!-- Overview Section -->
                        <div id="overviewSection" class="content-section">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Dashboard Overview</h2>
                                <button class="btn btn-primary" onclick="createNewTicket()">
                                    <i class="fas fa-plus me-1"></i>New Ticket
                                </button>
                            </div>

                            <!-- Stats Cards -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="totalTickets">0</h4>
                                                    <p class="mb-0">Total Tickets</p>
                                                </div>
                                                <i class="fas fa-ticket-alt fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-warning text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="openTickets">0</h4>
                                                    <p class="mb-0">Open Tickets</p>
                                                </div>
                                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-success text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="resolvedTickets">0</h4>
                                                    <p class="mb-0">Resolved</p>
                                                </div>
                                                <i class="fas fa-check-circle fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-danger text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="urgentTickets">0</h4>
                                                    <p class="mb-0">Urgent</p>
                                                </div>
                                                <i class="fas fa-fire fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Tickets -->
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Recent Tickets</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentTickets">
                                        <div class="text-center py-4">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tickets Section -->
                        <div id="ticketsSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Tickets</h2>
                                <div class="d-flex gap-2">
                                    <select class="form-select" id="ticketFilter" onchange="filterTickets()">
                                        <option value="">All Status</option>
                                        <option value="open">Open</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="resolved">Resolved</option>
                                        <option value="closed">Closed</option>
                                    </select>
                                    <button class="btn btn-primary" onclick="createNewTicket()">
                                        <i class="fas fa-plus me-1"></i>New Ticket
                                    </button>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div id="ticketsList">
                                        <div class="text-center py-4">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Customers Section -->
                        <div id="customersSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Customers</h2>
                                <div class="d-flex gap-2">
                                    <input type="text" class="form-control" id="customerSearch" placeholder="Search customers..." onkeyup="searchCustomers()">
                                    <select class="form-select" id="tierFilter" onchange="filterCustomers()">
                                        <option value="">All Tiers</option>
                                        <option value="bronze">Bronze</option>
                                        <option value="silver">Silver</option>
                                        <option value="gold">Gold</option>
                                        <option value="platinum">Platinum</option>
                                    </select>
                                    <button class="btn btn-outline-secondary" onclick="clearCustomerFilters()" title="Clear filters">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div id="customersList">
                                        <div class="text-center py-4">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Knowledge Base Section -->
                        <div id="knowledgeSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Knowledge Base</h2>
                                <button class="btn btn-primary" onclick="createNewArticle()">
                                    <i class="fas fa-plus me-1"></i>New Article
                                </button>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="knowledgeSearch" placeholder="Search knowledge base..." onkeyup="searchKnowledge()">
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="categoryFilter" onchange="filterKnowledge()">
                                        <option value="">All Categories</option>
                                        <option value="faq">FAQ</option>
                                        <option value="troubleshooting">Troubleshooting</option>
                                        <option value="policy">Policy</option>
                                        <option value="tutorial">Tutorial</option>
                                    </select>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div id="knowledgeList">
                                        <div class="text-center py-4">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Automation Section -->
                        <div id="automationSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>Automation Rules</h2>
                                <button class="btn btn-primary" onclick="createNewRule()">
                                    <i class="fas fa-plus me-1"></i>New Rule
                                </button>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div id="automationList">
                                        <div class="text-center py-4">
                                            <div class="spinner-border" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Issue Detection Section -->
                        <div id="issuesSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>AI-Powered Issue Detection</h2>
                                <div class="btn-group">
                                    <button class="btn btn-primary" onclick="runIssueAnalysis()">
                                        <i class="fas fa-search me-1"></i>Analyze Issues
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="exportIssueData()">
                                        <i class="fas fa-download me-1"></i>Export Data
                                    </button>
                                </div>
                            </div>

                            <!-- Health Overview -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="totalIssues">0</h4>
                                                    <p class="mb-0">Total Issues</p>
                                                </div>
                                                <i class="fas fa-exclamation-triangle fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-danger text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="criticalIssues">0</h4>
                                                    <p class="mb-0">Critical</p>
                                                </div>
                                                <i class="fas fa-fire fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-warning text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="highIssues">0</h4>
                                                    <p class="mb-0">High Priority</p>
                                                </div>
                                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-success text-white">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <h4 id="systemHealth">Good</h4>
                                                    <p class="mb-0">System Health</p>
                                                </div>
                                                <i class="fas fa-heartbeat fa-2x"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Issue Categories -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Supply Chain Health by Category</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="categoryHealthChart" class="row">
                                                <!-- Category health cards will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Detected Issues -->
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">Detected Issues</h5>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-primary" onclick="filterIssues('all')">All</button>
                                                <button class="btn btn-outline-danger" onclick="filterIssues('critical')">Critical</button>
                                                <button class="btn btn-outline-warning" onclick="filterIssues('high')">High</button>
                                                <button class="btn btn-outline-info" onclick="filterIssues('medium')">Medium</button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="issuesList">
                                                <div class="text-center py-4">
                                                    <div class="spinner-border" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Issue Details Sidebar -->
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0">Issue Details</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="issueDetails">
                                                <div class="text-center text-muted py-4">
                                                    <i class="fas fa-mouse-pointer fa-2x mb-2"></i>
                                                    <p>Select an issue to view details</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Trend Analysis -->
                                    <div class="card mt-3">
                                        <div class="card-header">
                                            <h6 class="mb-0">Trend Analysis</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="trendAnalysis">
                                                <div class="text-center py-4">
                                                    <div class="spinner-border spinner-border-sm" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Assistant Section -->
                        <div id="aiSection" class="content-section d-none">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h2>AI Chatbot Assistant</h2>
                                <div class="btn-group">
                                    <button class="btn btn-outline-primary" onclick="startNewConversation()">
                                        <i class="fas fa-plus me-1"></i>New Chat
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="exportConversation()">
                                        <i class="fas fa-download me-1"></i>Export
                                    </button>
                                </div>
                            </div>


                            <div class="row">
                                <!-- Chat Interface -->
                                <div class="col-md-8">
                                    <div class="card chat-container">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0" style="color: #212529;">
                                                <i class="fas fa-user me-2"></i>Smart Customer Simulator
                                                <span id="conversationStatus" class="badge bg-success ms-2">Ready</span>
                                            </h5>
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-secondary" onclick="clearConversation()" title="Clear Chat">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="toggleAnalytics()" title="View Analytics">
                                                    <i class="fas fa-chart-bar"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <!-- Chat Messages Area -->
                                        <div id="chatMessages" class="chat-messages">
                                            <div class="welcome-message text-center py-4">
                                                <i class="fas fa-user fa-3x text-muted mb-3"></i>
                                                <h5>Smart Customer Simulator</h5>
                                                <div class="row justify-content-center mb-3">
                                                    <div class="col-md-8">
                                                        <div class="card bg-light">
                                                            <div class="card-body py-3">
                                                                <h6 class="card-title mb-2">
                                                                    <i class="fas fa-user-circle me-2"></i>Customer Profile
                                                                </h6>
                                                                <div class="row g-2 text-start">
                                                                    <div class="col-6">
                                                                        <strong>Name:</strong> <span id="mockCustomerName">Sarah Johnson</span>
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <strong>Order ID:</strong> <span id="mockOrderId">#ORD-2024-001234</span>
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <strong>Email:</strong> sarah.johnson@email.com
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <strong>Issue:</strong> <span id="mockIssueCategory">Order Inquiry</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <p class="text-muted">The AI acts as this customer and analyzes your previous responses to give contextually appropriate replies. Use the Quick Response Templates on the right to respond professionally, or type your own custom response.</p>
                                                <div class="alert alert-info mt-3">
                                                    <i class="fas fa-brain me-2"></i>
                                                    <strong>Context-Aware:</strong> The customer will remember and respond to what you say based on the conversation history.
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Message Input Area -->
                                        <div class="chat-input-container p-3 border-top">
                                            <div class="input-group">
                                                <input type="text" id="chatInput" class="form-control" placeholder="Type your message here..." onkeypress="handleChatKeyPress(event)">
                                                <button class="btn btn-primary" onclick="sendChatMessage()" id="sendButton">
                                                    <i class="fas fa-paper-plane"></i>
                                                </button>
                                            </div>
                                            <div class="mt-2">
                                                <small class="text-muted">
                                                    <i class="fas fa-lightbulb me-1"></i>
                                                    Pro tip: Respond as a support agent to the customer's concerns
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sidebar with Templates and Tools -->
                                <div class="col-md-4">

                                    <!-- AI Tools - Moved up for better accessibility -->
                                    <div class="card mb-3">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-tools me-1"></i>AI Tools
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="analyzeSentiment()">
                                                        <i class="fas fa-heart me-1"></i>Sentiment
                                                    </button>
                                                </div>
                                                <div class="col-6">
                                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="suggestResponse()">
                                                        <i class="fas fa-lightbulb me-1"></i>Suggest
                                                    </button>
                                                </div>
                                                <div class="col-12">
                                                    <button class="btn btn-outline-primary btn-sm w-100" onclick="searchKnowledgeBase()">
                                                        <i class="fas fa-search me-1"></i>Search Knowledge Base
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Quick Templates -->
                                    <div class="card mb-3">
                                        <div class="card-header" style="cursor: pointer;" onclick="toggleTemplates()" data-bs-toggle="collapse" data-bs-target="#templatesCollapse" aria-expanded="false" aria-controls="templatesCollapse">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0">
                                                    <i class="fas fa-magic me-1"></i>Quick Response Templates
                                                </h6>
                                                <i class="fas fa-chevron-down" id="templatesChevron"></i>
                                            </div>
                                        </div>
                                        <div class="collapse" id="templatesCollapse">
                                            <div class="card-body">
                                                <p class="small text-muted mb-3">Click any template to use it as your response to the customer.</p>
                                                <div id="chatTemplates" class="d-grid gap-2">
                                                    <!-- Templates will be loaded here -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Conversation Analytics -->
                                    <div class="card" id="analyticsCard">
                                        <div class="card-header">
                                            <h6 class="mb-0">
                                                <i class="fas fa-chart-bar me-1"></i>Conversation Analytics
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="conversationAnalytics">
                                                <!-- Analytics will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="ticketModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Ticket</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="ticketForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Customer ID</label>
                                    <input type="text" class="form-control" id="ticketCustomerId" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="ticketCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="order">Order</option>
                                        <option value="shipping">Shipping</option>
                                        <option value="return">Return</option>
                                        <option value="technical">Technical</option>
                                        <option value="billing">Billing</option>
                                        <option value="general">General</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Subject</label>
                            <input type="text" class="form-control" id="ticketSubject" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="ticketDescription" rows="4" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Priority</label>
                                    <select class="form-select" id="ticketPriority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Channel</label>
                                    <select class="form-select" id="ticketChannel">
                                        <option value="email">Email</option>
                                        <option value="chat">Chat</option>
                                        <option value="phone">Phone</option>
                                        <option value="social">Social Media</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitTicket()">Create Ticket</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
